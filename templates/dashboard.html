<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Query Builder</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
</head>
<body class="dashboard-page">
  <div class="dashboard-layout">
    <aside class="sidebar">
      <h3><i class="fas fa-database"></i> QueryCraft</h3>
      <div class="user-pill"><i class="fas fa-user-circle"></i> {{ user }}</div>
      <nav>
        <ul>
          <li><a href="#create"><i class="fas fa-table"></i> Create Table</a></li>
          <li><a href="#insert"><i class="fas fa-plus-square"></i> Insert Data</a></li>
          <li><a href="#builder"><i class="fas fa-code"></i> Query Builder</a></li>
          <li><a href="#results"><i class="fas fa-table-list"></i> Results</a></li>
          <li><a href="/logout"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
        </ul>
      </nav>
    </aside>

  <main class="glass-container">
      <h2><i class="fas fa-user-circle"></i> Hello, {{ user }}</h2>
      {% if mode == 'sample' %}
        <div class="section-note">
          <form action="/reset_sample" method="POST" class="inline-form">
            <button type="submit"><i class="fas fa-rotate"></i> Reset Sample Data</button>
          </form>
          {% if tables %}
            <p>Sample tables: {{ ', '.join(tables) }}</p>
          {% endif %}
        </div>
      {% elif mode == 'workspace' %}
        <div class="section-note">
          {% if tables %}
            <p>Project tables: {{ ', '.join(tables) }}</p>
          {% else %}
            <p>No tables in current project yet. You can create one below.</p>
          {% endif %}
          <p><a href="{{ url_for('workspace_dashboard') }}"><i class="fas fa-briefcase"></i> Go to Workspace</a></p>
        </div>
      {% else %}
        <div class="section-note">
          <p>You are in legacy mode. <a href="{{ url_for('mode_select') }}">Choose a mode</a>.</p>
        </div>
      {% endif %}

      <section id="create">
        <h3>Create New Table</h3>
        <form action="/create_table" method="POST">
          <input type="text" name="table_name" placeholder="Table Name" required><br><br>
          <textarea name="columns" placeholder="Example: name TEXT, age INTEGER" required rows="3" cols="40"></textarea><br><br>
          <button type="submit">Create Table</button>
        </form>
      </section>

      <section id="insert">
        <h3>Insert Data Into Table</h3>
        <form action="/insert_data" method="POST">
          <input type="text" name="table_name" placeholder="Table Name" required><br><br>
          <textarea name="columns" placeholder="Columns (e.g., name, age)" required></textarea><br>
          <textarea name="values" placeholder="Values (e.g., 'John', 25)" required></textarea><br><br>
          <button type="submit">Insert</button>
        </form>
      </section>

      <section id="builder">
        <h3><i class="fas fa-database"></i> Build your SQL Query</h3>
        <form method="POST" action="/run-query">
          <label><i class="fas fa-table"></i> Select Table:</label>
          <select name="table" required>
            {% if tables %}
              {% for t in tables %}
                <option value="{{ t }}">{{ t }}</option>
              {% endfor %}
            {% else %}
              <option value="students">students</option>
              <option value="courses">courses</option>
              <option value="enrollments">enrollments</option>
            {% endif %}
          </select><br>

          <label><i class="fas fa-columns"></i> Select Columns (comma-separated):</label>
          <input type="text" name="columns" placeholder="e.g. name, age" required><br>

          <label><i class="fas fa-code-branch"></i> JOIN Statement (optional):</label>
          <input type="text" name="join" placeholder="e.g. JOIN dept ON emp.dept_id = dept.id"><br>

          <label><i class="fas fa-filter"></i> WHERE condition (optional):</label>
          <input type="text" name="where" placeholder="e.g. age > 18"><br>

          <label><i class="fas fa-users"></i> GROUP BY (optional):</label>
          <input type="text" name="group_by" placeholder="e.g. department"><br>

          <label><i class="fas fa-filter"></i> HAVING (optional):</label>
          <input type="text" name="having" placeholder="e.g. COUNT(*) > 1"><br>

          <label><i class="fas fa-sort"></i> ORDER BY (optional):</label>
          <input type="text" name="order_by" placeholder="e.g. age DESC"><br>

          <label><i class="fas fa-hashtag"></i> LIMIT (optional):</label>
          <input type="number" name="limit" placeholder="e.g. 10"><br>

          <button type="submit"><i class="fas fa-play"></i> Run Query</button>
        </form>
      </section>

    {% if query %}
      <section id="results">
        <h3><i class="fas fa-code"></i> SQL Query:</h3>
        <code>{{ query }}</code>

        <h3><i class="fas fa-lightbulb"></i> Explanation:</h3>
        <p>{{ explanation }}</p>

        <h3><i class="fas fa-table-list"></i> Result:</h3>
        {% if result %}
          <table>
            <tr>
              {% for col in headers %}
                <th>{{ col }}</th>
              {% endfor %}
            </tr>
            {% for row in result %}
              <tr>
                {% for col in row %}
                  <td>{{ col }}</td>
                {% endfor %}
              </tr>
            {% endfor %}
          </table>
        {% else %}
          <p>No results found.</p>
        {% endif %}
      </section>
      {% endif %}
    </main>
  </div>
</body>
</html>
